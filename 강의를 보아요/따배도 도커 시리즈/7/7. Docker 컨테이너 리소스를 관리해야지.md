```
👉 컨테이너를 실행 시킬 때, CPU/Memory/Disk IO 에 대한 리소스를 제한할 수 있음.
👉 상황에 맞게 찾아서 사용하고 모니터링 command/tool 있다는 것도 기억하기.
```
# 컨테이너 리소스 제한과 모니터링
## 컨테이너 리소스 제한
기본으로 컨테이너는 하드웨어 리소스의 사용 제한을 받지 않음.
컨테이너가 필요로 하는 만큼의 리소스만 할당해야함.

### Docker command 로 제한할 수 있는 리소스
- CPU
- Memory
- Disk I/O

`docker run --help` 로 가능한 옵션을 확인할 수 있음

### 메모리 제한
- b, k, m, g 단위로 제한할 수 있음.

| 옵션 | 설명 | 예시 |
| --- | --- | ---|
| -m, --memory | 컨테이너가 사용할 수 있는 최대 메모리 지정 | `docker run -m 512m nginx` |
| --memory-swap | 컨테이너가 사용할 스왑 메모리 영역 지정. 메모리 + 스왑 공간의 총합 제한. </br> 생략 시 메모리의 2배로 설정. </br> --memory와 함께 사용해야 의미가 있음. | `docker run -m 512m --memory-swap 1g nginx` </br> → 메모리 512MB + 스왑 512MB = 총 1GB 사용 |
| --memory-reservation | 소프트 제한 설정. 옵션의 값만큼은 보장한다는 의미. 호스트에 메모리 여유가 없을 때 옵션의 값까지 메모리 회수. | `docker run -m 512m --memory-reservation 256m nginx`|
| --oom-kill-disable | 컨테이너에 대해 커널 OOM(Out-Of-Memory) 킬러의 대상지정을 비활성화 | `docker run --oom-kill-disable --memory=512m myimage` |

### CPU 제한
| 옵션 | 의미 | 특징 | 예시|
| --- | --- | --- | --- |
| `--cpus`        | 컨테이너가 사용할 수 있는 CPU 코어 수를 소수점 단위로 제한 | 가장 직관적이고 실무에서 많이 사용됨. 내부적으로 `--cpu-quota`+`--cpu-period` 활용 | `--cpus="1.5"` → CPU 1.5코어까지 사용       |
| `--cpuset-cpus` | 컨테이너가 실행될 수 있는 물리 CPU 번호 지정| 특정 코어에 바인딩 → 성능 튜닝이나 NUMA 최적화 시 사용 | `--cpuset-cpus="0,2"` → 0번, 2번 코어만 사용 |
| `--cpu-shares`  | 컨테이너의 CPU 점유 비율 가중치 설정 | 절대 제한 아님. CPU가 남을 땐 무제한, 부족할 때만 비율로 분배 | A=1024, B=512 → CPU 부족 시 A가 B보다 2배 점유 |

### Block I/O 제한
- bps : ytes per second
- iops : I/O Operations per second

| 옵션 | 설명 | 사용 예시 |
| :--- | :--- | :--- |
| `--blkio-weight <가중치>` </br> `--blkio-weight-device` | 다른 컨테이너와의 I/O 경합 시 할당받는 대역폭의 상대적 비율을 설정. (범위: 10 ~ 1000, 기본값: 500) | `docker run --blkio-weight 600 my_image` |
| `--device-read-bps <장치>:<속도>` | 특정 블록 장치(`device`)의 초당 **읽기** 처리량을 바이트 단위로 제한. (단위: `kb`, `mb`, `gb`) | `docker run --device-read-bps /dev/sda:1mb my_image` |
| `--device-write-bps <장치>:<속도>` | 특정 블록 장치(`device`)의 초당 **쓰기** 처리량을 바이트 단위로 제한. (단위: `kb`, `mb`, `gb`) | `docker run --device-write-bps /dev/sda:500kb my_image` |
| `--device-read-iops <장치>:<횟수>` | 특정 블록 장치(`device`)의 초당 **읽기** 작업 횟수(IOPS)를 제한. </br> 초당 quota 를 제한해서 I/O 발생. 정수로 표기. </br> 초당 데이터 전송량 = IOPS * 블럭 크기 | `docker run --device-read-iops /dev/sda:1000 my_image` |
| `--device-write-iops <장치>:<횟수>` | 특정 블록 장치(`device`)의 초당 **쓰기** 작업 횟수(IOPS)를 제한. | `docker run --device-write-iops /dev/sda:500 my_image` |


## 모니터링
### command
- `docker stat` : 동작중인 컨테이너의 통계 확인
- `docker events` : 도커 호스트의 실시간 event 정보 수집해 출력

### tool
- cAdvisor