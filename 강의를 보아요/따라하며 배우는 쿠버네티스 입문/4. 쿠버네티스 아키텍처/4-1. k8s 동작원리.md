# 요약
- 쿠버네티스의 컴포넌트와 동작 흐름
- 컴포넌트 외의 애드온

# 쿠버네티스에서 컨테이너의 동작 흐름
- Scheduler : 컨테이너를 실행할 노드를 . 노드 상태를 보고 선택.
- Api Server : 선택된 노드에 kubelet 에 요청. 
- kubelet : 이 요청을 도커 요청으로 바꿔서 Docker Daemon 에 실행 요청
쿠버네티스는 동작되는 컨테이너를 파드라는 단위로 관리.

![쿠버네티스 동작 흐름](images/k8s_flow.png)
- https://rection34.tistory.com/132

# 컴포넌트
## 마스터 컴포넌트
- etcd
  - key-value 타입의 저장소
  - 쿠버네티스에 관한 정보
- kube-apiserver
  - k8s API를 사용하도록 요청을 받고 요청이 유효한지 검사
- kube-scheduler
  - 파드를 실행할 노드 선택
- kube-controller-manager
  - 파드를 관찰하며 개수를 보장

```
✔ etcd
유닉스에서 구성 데이터를 저장하는 /etc 폴더와 distributed system 의 d 와 합쳐진 말.
분산된 시스템에 대한 구성 데이터를 저장한다.
```

## 워커 노드 컴포넌트
- kubelet
  - 모든 노드에서 실행되는 k8s 에이전트
  - 데몬 형태로 동작
- kube-proxy
  - k8s의 network 동작을 관리
  - iptables rule 구성
- 컨테이너 런타임
  - 컨테이너를 실행하는 엔진
  - docker, containerd, runc

![](images/k8s_arch.png)
master 에는 api compoent 가 있는데, 사용자가 kubectl 명령어로 요청함.
api server 가 그 요청내용을 받아서 문법과, 권한 등을 검사
합당하다면 api server 는 요청을 실행하려고 함.

etcd 는 저장소임. 키 벨류 타입의 저장소
워커 노드들에 대한 상태 정보, 리소스 사용정보, 컨테이너 혹으 ㄴ이미지의 상태 등등
- kubelet 은 데몬인데 이 안에 cadviser 라는 컨테이너 모니터링 툴이 포함되어있음.그래서 이걸 써서 워커노트드의 상태 정보를 수집해서 마스터에 전달. 마스터는 이걸 etcd 저장소에 저장한다.
워커 노드들에 대한 상태 정보, 
delpoy 를 만든다면, deploy 상태정보도 포함함

api server -> eetcd 에서 노드 정보 확인하고,
scheduler 에 어떤거를 실행시킬건데, 어떤 노드가 가장 합당한지 ㅈ리의
etcd 정보를 바탕으로 scheduler 가 응답한다.
api 는 이 정보를 가지고, 특정 노드의 kubelet 에 요청한다

kubelet 은 도커 엔진은 아니니까 요청받은거를 도커 명령어로 요청하면, 도커가 명령 실행. (허브에서 이미지 가져오서 실행시키는 둥)

컨트롤러는 감시. 노드가 죽었을 때, 부족하면 API 에 요청함.
그러면 위 작업을 다시 함.

요청받아서 메인으로 관리하는거가 api 

coreDNS 와 컨테이너와 컨테이너간에 통신지원하는 네트워크 애드온 프로그램으로 CNI ( ?) 는 우리가 추가적으로 설치할 수 있음.
애드온 프로그램은 베이스로 설치된다..? 

----

이제 워커노드

kubelet이 데몬형태로 .그리고 그 안에 컨테이너 모니터링 툴이 들어가있고,
kube-proxy는 실제 쿠버네티스 네트워크를 담당한다.
container 런타임 = 도커 : 실제 컨테이너를 실행하는 것.


```
✔ 데몬 (daemon)
- 사용자가 직접 제어하지 않고 백그라운드에서 실행되는 프로그램

✔ iptables
- 리눅스에서 트래픽을 관리하기 위한 방화벽 설정 도구

✔ NIC (Network Interface Card)
- 컴퓨터를 네트워크에 연결하여 통신하기 위해 사용하는 하드웨어 장치
```

## 애드온
### 네트워크 애드온
- CNI - weave, calico, flannel, kube-route

### DNS 애드온
- core DNS

### 대쉬보드 애드온
### 컨테이너 자원 모니터링
- cAdvisor
### 클러스터 로깅
- 컨테이너 로그, k8s 운영 로그들을 수집해서 중앙화
- ELK(ELasticSearch, Logstash, Kibana), 
EFk(ES, Fluentd, Kibana), DataDog

# TODO
- 마스터 컴포넌트와 워커 노드 컴포넌트, 설치는? 포함?
- etcd 는 마스터 노드 각각에 있는지. 개별 관리? 공유 관리?