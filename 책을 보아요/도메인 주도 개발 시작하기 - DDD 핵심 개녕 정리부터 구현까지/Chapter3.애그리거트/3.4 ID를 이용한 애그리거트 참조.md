```
👉 애그리거트가 다른 애그리거트를 참조하는 방식으로 직접 참조와 ID 참조가 있다. 각 방법의 장단을 설명한다.
```

# 3.4 ID를 이용한 애그리거트 참조

## 애그리거트 직접 참조
- 애그리거트가 다른 애그리거트를 필드로 직접 참조하는 방식은 구현의 편리함이 있지만, 다음의 문제점이 있음.

### 문제점
1. 편리함 오용
    - 직접 접근하게 되면, 한 애그리거트 내부에서 다른 애그리거트의 상태를 변경할 수 있게됨.
    - 이는 앞에서 말한 단점을 갖게 되고, 애그리거트 간 의존 결합도를 높여 애그리거트의 변경을 어렵게 함.
2. 성능 고민
    - JPA 를 사용한다면, 지연/즉시 로딩 및 매핑 전략을 고려해야함.
3. 확장 어려움
    - 도메인마다 다른 종류의 저장소를 사용할 수 있음. 즉 다른 애그리거트를 참조하기 위해 단일 기술을 사용할 수 없게됨.

## ID 참조
- 위 문제점을 완화할 수 있는 방법으로 ID 참조가 있음. DB 테이블의 외래키와 유사함.
- 애그리거트간 경계를 명확히 할 수 있고, 물리적인 연결을 제거함.

### 조회 성능
- DB 에서 조인하여 조회할 수 있는 데이터를, 조회 대상 데이터와 연관 대상 데이터를 각 각 각 조회해야야 함.

```
💡 N + 1 조회 문제
조회 대상이 N 개일 때, 조회 대상 N 개를 조회하는 한 번의 쿼리와 연관 대상을 조회하는 N 개의 쿼리를 실행함.
지연 로딩과 관련된 대표적인 문제.
```

### 완화 방법
- 데이터 조회를 위한 별도의 DAO 와 조회 전용 쿼리를 사용.
- 만약 애그리거트마다 다른 저장소를 사용한다면, `캐쉬` 나 `조회 전용 저장소` 를 사용할 수 있음.
    - 코드가 복잡해지지만, 처리량은 높일 수 있음.